@model IEnumerable<ProjectViewModel>

@{
    ViewData["Title"] = "Projects";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="~/js/chartDrawer.js" asp-append-version="true"></script>

<div class="text-left">
    <p>
    <h3>Projects</h3>
    </p>
</div>
<div>
    @if (service.user.role is ProjectManager)
    {
        <a class="btn btn-success" asp-controller="Projects" asp-action="Create">
            <i class="fa-solid fa-book"></i> Create new project
        </a>
    }
</div>
<div>
    @foreach (var viewModel in Model)
    {
        <h1>@viewModel.project.name</h1>
        <h5>@viewModel.project.description</h5>
        <h5>Members (@viewModel.members.Count) :</h5>
        foreach (var member in viewModel.members)
        {
            <h7>@member.name</h7>
            <br />
        }
        <h5>Tickets (@viewModel.tickets.Count)</h5>
        @if (viewModel.tickets.Count != 0)
        {
            <div class="ticket-type-chart-div">
                <canvas id="@viewModel.project.name-ticket-type-chart"></canvas>
                <script>
                    drawChart(
                        "@viewModel.project.name-ticket-type-chart",
                        @Json.Serialize(viewModel.GetTicketTypes()),
                        @Json.Serialize(viewModel.GetTicketTypesColors()),
                        @Json.Serialize(viewModel.GetTicketTypesCount()))
                </script>
            </div>
            <div class="ticket-priority-chart-div">
                <canvas id="@viewModel.project.name-ticket-priority-chart"></canvas>
                <script>
                    drawChart(
                        "@viewModel.project.name-ticket-priority-chart",
                        @Json.Serialize(viewModel.GetTicketPriorities()),
                        @Json.Serialize(viewModel.GetTicketPriorityColors()),
                        @Json.Serialize(viewModel.GetTicketPriorityCount()))
                </script>
            </div>
            <div class="ticket-status-chart-div">
                <canvas id="@viewModel.project.name-ticket-status-chart"></canvas>
                <script>
                    drawChart(
                        "@viewModel.project.name-ticket-status-chart",
                        @Json.Serialize(viewModel.GetTicketStatuses()),
                        @Json.Serialize(viewModel.GetTicketStatusColors()),
                        @Json.Serialize(viewModel.GetTicketStatusCount()))
                </script>
            </div>
        }
        if (service.user.role is ProjectManager)
        {
            <div class="edit-btn">
                <a class="link-icon" title="Edit user" asp-controller="Projects" asp-action="Edit" asp-route-id="@viewModel.project.id">
                    <i class="fa-solid fa-pen-to-square"></i>
                </a>
            </div>
            <div class="delete-btn">
                <a class="link-icon" asp-controller="Projects" asp-action="Delete" asp-route-id="@viewModel.project.id">
                    <i class="fa-solid fa-trash"></i>
                </a>
            </div>
        }
    }
</div>